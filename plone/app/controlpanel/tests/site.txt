Site control panel
==================

Test setup::

    >>> app = layer['app']
    >>> from plone.testing.z2 import Browser
    >>> browser = Browser(app)
    >>> browser.handleErrors = False
    >>> browser.addHeader('Authorization', 'Basic admin:secret')
    >>> portal = layer['portal']
    >>> from zope.component import getUtility
    >>> from plone.registry.interfaces import IRegistry
    >>> from plone.app.controlpanel.interfaces import ISiteSchema
    >>> registry = getUtility(IRegistry)
    >>> settings = registry.forInterface(ISiteSchema)


Viewing the site control panel
-----------------------------

    >>> browser.open('http://nohost/plone/@@site-controlpanel')
    >>> browser.url
    'http://nohost/plone/@@site-controlpanel'

Click the cancel button:

    >>> browser.getControl("Cancel").click()
    >>> browser.url.endswith('plone_control_panel')
    True

There should be still no changes:

    >>> 'Changes canceled.' in browser.contents
    True

Make some changes
-----------------

    >>> browser.open('http://nohost/plone/@@site-controlpanel')
    >>> browser.url.endswith('site-controlpanel')
    True

    >>> browser.getControl(name='form.widgets.site_title').value = "Site"
    >>> browser.getControl(name='form.widgets.enable_sitemap:list').value = True

Click the save button:

    >>> browser.getControl("Save").click()
    >>> browser.url.endswith('site-controlpanel')
    True

We should be informed that something has changed:

    >>> 'Changes saved.' in browser.contents
    True

Make sure the changes have been applied correctly to the tool:

    >>> settings.enable_sitemap
    True

Test if the sitemaps does appear:

    >>> browser.open("http://nohost/plone/sitemap.xml.gz")
    >>> headers = browser.headers

    >>> headers['status'].lower()
    '200 ok'

    >>> headers['content-type']
    'application/octet-stream'

Make again some changes
-----------------------

    >>> browser.open('http://nohost/plone/@@site-controlpanel')
    >>> browser.url.endswith('site-controlpanel')
    True

    >>> browser.getControl(name='form.widgets.enable_sitemap:list').value = False

Click the save button:

    >>> browser.getControl("Save").click()
    >>> browser.url.endswith('site-controlpanel')
    True

We should be informed that something has changed:

    >>> 'Changes saved.' in browser.contents
    True

Make sure the changes have been applied correctly to the tool:

    >>> settings.enable_sitemap
    False

Check the sitemap actually, should raise a 404:

    >>> browser.handleErrors = True
    >>> from zope.publisher.interfaces import NotFound
    >>> from urllib2 import HTTPError
    >>> try:
    ...     browser.open("http://nohost/plone/sitemap.xml.gz")
    ... except HTTPError, e:
    ...     if e.code == 404:
    ...         print "ok"
    ok


Test the DC properties
----------------------

    >>> browser.open('http://nohost/plone/@@site-controlpanel')
    >>> browser.url.endswith('site-controlpanel')
    True

    >>> browser.getControl(name='form.widgets.exposeDCMetaTags:list').value = True

Click the save button:

    >>> browser.getControl("Save").click()
    >>> browser.url.endswith('site-controlpanel')
    True

We should be informed that something has changed:

    >>> 'Changes saved.' in browser.contents
    True

Make sure the changes have been applied correctly to the tool:

    >>> settings.exposeDCMetaTags
    True

Test if DC meta tags are exposed:

    >>> browser.open("http://nohost/plone/")
    >>> 'DC.type' in browser.contents
    True
